# 后端项目重构计划

## 项目概述
本计划旨在对现有后端项目进行重构，包括路由结构优化、异常处理统一、Redis缓存应用以及API层整体重构。

## 重构目标
1. 优化路由结构，按功能模块分类
2. 实现统一的异常处理机制
3. 合理应用Redis缓存
4. 重构API层，消除代码重复

## 详细任务清单

### 1. 路由结构重构
- [ ] 移除多余的路由文件 (router_new.py, router_refactored.py, router_public.py)
- [ ] 创建新的路由目录结构
  - [ ] `/` (根目录 - 健康检查、文档等)
  - [ ] `/public` (公共接口 - 登录注册等通用功能)
  - [ ] `/client` (客户端API - 用户业务功能，无需管理员权限)
  - [ ] `/admin` (管理员API - 需要管理员身份)
- [ ] 将现有API端点按功能重新分配到对应目录
- [ ] 更新主路由文件 (router.py) 以适应新结构

### 2. 数据库配置优化
- [ ] 移除SQLite自动降级功能
- [ ] 强制使用PostgreSQL作为唯一数据库选项
- [ ] 优化数据库连接配置

### 3. 统一异常处理
- [ ] 创建全局异常处理器
- [ ] 定义标准错误响应格式
- [ ] 统一各API端点的异常处理方式
- [ ] 实现简洁、原生的异常处理机制

### 4. Redis缓存应用
- [ ] 分析现有API端点，识别适合缓存的数据
- [ ] 实现用户信息缓存
- [ ] 实现频繁查询数据的缓存
- [ ] 实现API响应缓存策略
- [ ] 添加缓存失效机制

### 5. API层重构
- [ ] 消除用户验证和更新逻辑的重复代码
- [ ] 创建通用的服务层方法
- [ ] 优化数据库查询，解决潜在的N+1问题
- [ ] 实现分页和过滤的通用方法

### 6. 安全性增强
- [ ] 移除默认SECRET_KEY
- [ ] 移除默认管理员凭据
- [ ] 优化CORS配置（基于nginx配置）

### 7. 代码质量提升
- [ ] 添加类型提示完善性检查
- [ ] 优化代码注释和文档
- [ ] 实施代码规范检查

## 实施步骤

### 第一阶段：基础设施准备
1. 创建新的路由目录结构
2. 实现统一异常处理机制
3. 准备Redis缓存基础功能

### 第二阶段：核心重构
1. 迁移现有API端点到新路由结构
2. 应用Redis缓存到关键API
3. 重构重复代码逻辑

### 第三阶段：优化和完善
1. 移除旧的路由文件
2. 优化数据库配置
3. 完善文档和测试

## 预期收益
- 更清晰的代码结构和路由组织
- 更好的性能（通过缓存）
- 更统一的错误处理
- 更高的代码复用率
- 更强的安全性