# ç½‘ç»œå±‚æ¶æ„æ–‡æ¡£

## æ¦‚è¿°

æ–°çš„ç½‘ç»œå±‚æ¶æ„å›´ç»•è‡ªåŠ¨ç”Ÿæˆçš„ `RestClient` æ„å»ºï¼Œæä¾›ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†ã€Token ç®¡ç†ã€æ—¥å¿—è¾“å‡ºå’Œç®€å•æ–¹ä¾¿çš„è¯·æ±‚æ¥å£ã€‚

## æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Features (é¡µé¢/ç»„ä»¶)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Services (ä¸šåŠ¡æœåŠ¡å±‚)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ AuthService  â”‚  â”‚ProfileServiceâ”‚  â”‚  ImService   â”‚ ...  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Generated API Clients (è‡ªåŠ¨ç”Ÿæˆçš„ API å®¢æˆ·ç«¯)        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚Authenticationâ”‚  â”‚UserProfile   â”‚  â”‚  Messages    â”‚ ...  â”‚
â”‚  â”‚   Client     â”‚  â”‚   Client     â”‚  â”‚   Client     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ApiClient                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â€¢ Dio åˆå§‹åŒ–                                         â”‚  â”‚
â”‚  â”‚ â€¢ æ‹¦æˆªå™¨ç®¡ç†                                        â”‚  â”‚
â”‚  â”‚ â€¢ å¼‚å¸¸è½¬æ¢                                          â”‚  â”‚
â”‚  â”‚ â€¢ è¯·æ±‚æ‰§è¡Œ                                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                â”‚                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ApiInterceptor â”‚ â”‚ TokenManager  â”‚ â”‚ ApiException    â”‚
â”‚                â”‚ â”‚               â”‚ â”‚                 â”‚
â”‚ â€¢ Token ç®¡ç†   â”‚ â”‚ â€¢ ä¿å­˜ Token  â”‚ â”‚ â€¢ å¼‚å¸¸ä½“ç³»      â”‚
â”‚ â€¢ é”™è¯¯å¤„ç†     â”‚ â”‚ â€¢ è·å– Token  â”‚ â”‚ â€¢ é”™è¯¯è½¬æ¢      â”‚
â”‚ â€¢ æ—¥å¿—è¾“å‡º     â”‚ â”‚ â€¢ æ¸…é™¤ Token  â”‚ â”‚ â€¢ é”™è¯¯æ¶ˆæ¯      â”‚
â”‚ â€¢ 401 å¤„ç†     â”‚ â”‚ â€¢ Token è¿‡æœŸ  â”‚ â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                â”‚                â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                â”‚                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  StorageManagerâ”‚ â”‚  FlutterSecureâ”‚ â”‚  Logger         â”‚
â”‚                â”‚ â”‚  Storage      â”‚ â”‚                 â”‚
â”‚ â€¢ å®‰å…¨å­˜å‚¨     â”‚ â”‚               â”‚ â”‚ â€¢ å½©è‰²æ—¥å¿—      â”‚
â”‚ â€¢ Token å­˜å‚¨   â”‚ â”‚ â€¢ åŠ å¯†å­˜å‚¨    â”‚ â”‚ â€¢ è¯¦ç»†ä¿¡æ¯      â”‚
â”‚ â€¢ ç¼“å­˜ç®¡ç†     â”‚ â”‚ â€¢ å¹³å°é€‚é…    â”‚ â”‚ â€¢ é”™è¯¯è¿½è¸ª      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ ¸å¿ƒç»„ä»¶

### 1. [`api_exception.dart`](api_exception.dart) - å¼‚å¸¸å¤„ç†

å®šä¹‰äº†ç»Ÿä¸€çš„å¼‚å¸¸ä½“ç³»ï¼š

- **`ApiException`** - åŸºç±»
- **`NetworkException`** - ç½‘ç»œå¼‚å¸¸ï¼ˆè¶…æ—¶ã€è¿æ¥é”™è¯¯ç­‰ï¼‰
- **`AuthException`** - è®¤è¯å¼‚å¸¸ï¼ˆ401ã€403ã€Token è¿‡æœŸç­‰ï¼‰
- **`ServerException`** - æœåŠ¡å™¨å¼‚å¸¸ï¼ˆ5xx é”™è¯¯ï¼‰
- **`ValidationException`** - éªŒè¯å¼‚å¸¸ï¼ˆ400 é”™è¯¯ï¼‰
- **`ParseException`** - è§£æå¼‚å¸¸

### 2. [`api_interceptor.dart`](api_interceptor.dart) - æ‹¦æˆªå™¨

å¤„ç†ä»¥ä¸‹åŠŸèƒ½ï¼š

- **Token ç®¡ç†**ï¼šè‡ªåŠ¨é™„åŠ  Bearer Token åˆ°è¯·æ±‚å¤´
- **å…¬å¼€ç«¯ç‚¹ç™½åå•**ï¼šè·³è¿‡ä¸éœ€è¦è®¤è¯çš„æ¥å£
- **é”™è¯¯å¤„ç†**ï¼šæ•è· 401 é”™è¯¯å¹¶æ¸…é™¤æœ¬åœ°è®¤è¯ä¿¡æ¯
- **æ—¥å¿—è¾“å‡º**ï¼šä½¿ç”¨ `logger` åŒ…è¾“å‡ºè¯¦ç»†çš„è¯·æ±‚/å“åº”æ—¥å¿—

### 3. [`api_client.dart`](api_client.dart) - API å®¢æˆ·ç«¯

å›´ç»•ç”Ÿæˆçš„ `RestClient` çš„å°è£…ï¼š

- **å•ä¾‹æ¨¡å¼**ï¼šå…¨å±€å”¯ä¸€å®ä¾‹
- **Dio åˆå§‹åŒ–**ï¼šé…ç½®åŸºç¡€ URLã€è¶…æ—¶æ—¶é—´ã€æ‹¦æˆªå™¨
- **å¼‚å¸¸è½¬æ¢**ï¼šå°† `DioException` è½¬æ¢ä¸º `ApiException`
- **è¯·æ±‚æ‰§è¡Œ**ï¼šæä¾› `execute()` æ–¹æ³•ç»Ÿä¸€å¤„ç†è¯·æ±‚

### 4. [`token_manager.dart`](token_manager.dart) - Token ç®¡ç†å™¨

ç»Ÿä¸€å¤„ç† Token çš„è·å–ã€ä¿å­˜ã€åˆ·æ–°å’Œæ¸…é™¤ï¼š

- **ä¿å­˜ Token**ï¼š`saveTokens(accessToken, refreshToken)`
- **è·å– Token**ï¼š`getAccessToken()` / `getRefreshToken()`
- **æ¸…é™¤ Token**ï¼š`clearTokens()`
- **æ£€æŸ¥ Token**ï¼š`hasToken()`
- **Token è¿‡æœŸ**ï¼š`handleTokenExpired()` + `tokenExpired` é€šçŸ¥

## ä½¿ç”¨æŒ‡å—

### åŸºç¡€ä½¿ç”¨

#### 1. ç™»å½•

```dart
import 'package:bipupu/core/network/network.dart';

try {
  final token = await ApiClient.instance.api.authentication.postApiPublicLogin(
    body: UserLogin(username: 'user@example.com', password: 'password123'),
  );
  
  // ä¿å­˜ Token
  await TokenManager.saveTokens(
    accessToken: token.accessToken,
    refreshToken: token.refreshToken,
  );
  
  print('ç™»å½•æˆåŠŸ');
} on AuthException catch (e) {
  print('è®¤è¯å¤±è´¥: ${e.message}');
} on NetworkException catch (e) {
  print('ç½‘ç»œé”™è¯¯: ${e.message}');
}
```

#### 2. è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

```dart
try {
  final user = await ApiClient.instance.api.userProfile.getApiProfileMe();
  print('ç”¨æˆ·å: ${user.username}');
} on AuthException catch (e) {
  // Token è¿‡æœŸæˆ–æ— æ•ˆï¼Œéœ€è¦é‡æ–°ç™»å½•
  print('éœ€è¦é‡æ–°ç™»å½•: ${e.message}');
}
```

#### 3. å‘é€æ¶ˆæ¯

```dart
try {
  final message = await ApiClient.instance.api.messages.postMessage(
    body: MessageCreate(content: 'Hello, World!', recipientId: 'user_id_123'),
  );
  print('æ¶ˆæ¯å·²å‘é€: ${message.id}');
} on ValidationException catch (e) {
  print('éªŒè¯å¤±è´¥: ${e.message}');
  if (e.errors != null) {
    print('é”™è¯¯è¯¦æƒ…: ${e.errors}');
  }
}
```

### é«˜çº§ä½¿ç”¨

#### 1. è‡ªå®šä¹‰è¯·æ±‚æ‰§è¡Œ

```dart
final apiClient = ApiClient.instance;

try {
  final result = await apiClient.execute(
    () => apiClient.api.users.searchUsers(q: 'john'),
    operationName: 'SearchUsers',
  );
} on ApiException catch (e) {
  print('API é”™è¯¯: ${e.message}');
}
```

#### 2. å¼‚å¸¸å¤„ç†

```dart
try {
  await ApiClient.instance.api.authentication.postApiPublicLogin(
    body: UserLogin(username: 'user', password: 'pass'),
  );
} catch (e) {
  if (e is AuthException) {
    print('ğŸ” è®¤è¯å¼‚å¸¸: ${e.message}');
  } else if (e is ServerException) {
    print('ğŸ–¥ï¸ æœåŠ¡å™¨å¼‚å¸¸: ${e.message}');
  } else if (e is NetworkException) {
    print('ğŸŒ ç½‘ç»œå¼‚å¸¸: ${e.message}');
  } else if (e is ValidationException) {
    print('âœ“ éªŒè¯å¼‚å¸¸: ${e.message}');
  }
}
```

#### 3. Token ç®¡ç†

```dart
// æ£€æŸ¥ Token æ˜¯å¦å­˜åœ¨
final hasToken = await TokenManager.hasToken();

// è·å– Token
final token = await TokenManager.getAccessToken();

// æ¸…é™¤ Token
await TokenManager.clearTokens();

// ç›‘å¬ Token è¿‡æœŸäº‹ä»¶
TokenManager.tokenExpired.addListener(() {
  if (TokenManager.tokenExpired.value) {
    // é‡å®šå‘åˆ°ç™»å½•é¡µ
    print('Token å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•');
  }
});
```

#### 4. æ·»åŠ è‡ªå®šä¹‰æ‹¦æˆªå™¨

```dart
final apiClient = ApiClient.instance;

// æ·»åŠ è‡ªå®šä¹‰æ‹¦æˆªå™¨
apiClient.addInterceptor(MyCustomInterceptor());

// ç§»é™¤æ‹¦æˆªå™¨
apiClient.removeInterceptor(myInterceptor);

// æ¸…é™¤æ‰€æœ‰æ‹¦æˆªå™¨
apiClient.clearInterceptors();

// é‡ç½® Dio å®ä¾‹
apiClient.reset();
```

## ç‰¹æ€§

### âœ… Token ç®¡ç†

- è‡ªåŠ¨ä» `StorageManager` è¯»å– Token
- è‡ªåŠ¨é™„åŠ åˆ°è¯·æ±‚å¤´
- æ”¯æŒå…¬å¼€ç«¯ç‚¹ç™½åå•
- 401 é”™è¯¯æ—¶è‡ªåŠ¨æ¸…é™¤æœ¬åœ° Token
- Token è¿‡æœŸé€šçŸ¥æœºåˆ¶

### âœ… é”™è¯¯å¤„ç†

- ç»Ÿä¸€çš„å¼‚å¸¸ä½“ç³»
- è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
- è‡ªåŠ¨å¼‚å¸¸è½¬æ¢
- æ”¯æŒè‡ªå®šä¹‰é”™è¯¯å¤„ç†
- é”™è¯¯å †æ ˆè·Ÿè¸ª

### âœ… æ—¥å¿—è¾“å‡º

- ä½¿ç”¨ `logger` åŒ…è¾“å‡ºå½©è‰²æ—¥å¿—
- è¯·æ±‚/å“åº”è¯¦ç»†ä¿¡æ¯
- é”™è¯¯å †æ ˆè·Ÿè¸ª
- ä»…åœ¨ Debug æ¨¡å¼ä¸‹è¾“å‡º

### âœ… ç®€å•æ–¹ä¾¿

- å•ä¾‹æ¨¡å¼ï¼Œå…¨å±€è®¿é—®
- ç›´æ¥è®¿é—®ç”Ÿæˆçš„ API å®¢æˆ·ç«¯
- è‡ªåŠ¨å¼‚å¸¸å¤„ç†
- æ”¯æŒè‡ªå®šä¹‰æ‹¦æˆªå™¨

## é…ç½®

### åŸºç¡€ URL

åŸºç¡€ URL é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®ï¼š

```bash
flutter run --dart-define=API_BASE_URL=https://api.example.com
```

é»˜è®¤å€¼ï¼š`https://api.205716.xyz`

### è¶…æ—¶æ—¶é—´

åœ¨ [`api_client.dart`](api_client.dart) ä¸­ä¿®æ”¹ï¼š

```dart
connectTimeout: const Duration(seconds: 15),
receiveTimeout: const Duration(seconds: 15),
sendTimeout: const Duration(seconds: 15),
```

### æ—¥å¿—çº§åˆ«

åœ¨ [`api_interceptor.dart`](api_interceptor.dart) ä¸­ä¿®æ”¹ `Logger` é…ç½®ã€‚

## æœ€ä½³å®è·µ

1. **ä½¿ç”¨ TokenManager**ï¼šç»Ÿä¸€é€šè¿‡ `TokenManager` ç®¡ç† Token
2. **å¼‚å¸¸å¤„ç†**ï¼šå§‹ç»ˆä½¿ç”¨ try-catch å¤„ç† API è°ƒç”¨
3. **Token ç®¡ç†**ï¼šä¸è¦æ‰‹åŠ¨ç®¡ç† Tokenï¼Œç”±æ‹¦æˆªå™¨è‡ªåŠ¨å¤„ç†
4. **æ—¥å¿—è¾“å‡º**ï¼šä½¿ç”¨ `logger` åŒ…è€Œä¸æ˜¯ `print()`
5. **é”™è¯¯æ¶ˆæ¯**ï¼šä½¿ç”¨å¼‚å¸¸çš„ `message` å±æ€§è·å–ç”¨æˆ·å‹å¥½çš„é”™è¯¯æ¶ˆæ¯
6. **ä¸šåŠ¡æœåŠ¡**ï¼šåœ¨å„è‡ªçš„ Service ä¸­è°ƒç”¨ APIï¼Œä¸è¦åœ¨ UI å±‚ç›´æ¥è°ƒç”¨

## è¿ç§»æŒ‡å—

### ä»æ—§ç½‘ç»œå±‚è¿ç§»

#### æ—§ä»£ç 
```dart
import 'package:bipupu/core/network/network_service.dart';

final networkService = NetworkService.instance;
final user = await networkService.api.userProfile.getMe();
```

#### æ–°ä»£ç 
```dart
import 'package:bipupu/core/network/network.dart';

final user = await ApiClient.instance.api.userProfile.getApiProfileMe();
```

## å¸¸è§é—®é¢˜

### Q: å¦‚ä½•å¤„ç† Token è¿‡æœŸï¼Ÿ

A: å½“æ”¶åˆ° `AuthException` æ—¶ï¼Œåº”è¯¥æ¸…é™¤æœ¬åœ°æ•°æ®å¹¶é‡å®šå‘åˆ°ç™»å½•é¡µã€‚æ‹¦æˆªå™¨ä¼šè‡ªåŠ¨æ¸…é™¤ Tokenï¼Œ`TokenManager.tokenExpired` ä¼šå‘å‡ºé€šçŸ¥ã€‚

### Q: å¦‚ä½•æ·»åŠ è‡ªå®šä¹‰è¯·æ±‚å¤´ï¼Ÿ

A: åœ¨ `ApiClient._initializeDio()` ä¸­ä¿®æ”¹ `BaseOptions.headers`ã€‚

### Q: å¦‚ä½•å¤„ç†æ–‡ä»¶ä¸Šä¼ ï¼Ÿ

A: ä½¿ç”¨ç”Ÿæˆçš„ API æ–¹æ³•ï¼Œä¾‹å¦‚ `api.userProfile.postApiProfileAvatar(file: file)`ã€‚

### Q: å¦‚ä½•è°ƒè¯•ç½‘ç»œè¯·æ±‚ï¼Ÿ

A: å¯ç”¨ Debug æ¨¡å¼ï¼Œæ—¥å¿—ä¼šè‡ªåŠ¨è¾“å‡ºåˆ°æ§åˆ¶å°ã€‚

### Q: Token å­˜å‚¨åœ¨å“ªé‡Œï¼Ÿ

A: Token å­˜å‚¨åœ¨ `StorageManager` çš„å®‰å…¨å­˜å‚¨ä¸­ï¼Œä½¿ç”¨ `FlutterSecureStorage` åŠ å¯†å­˜å‚¨ã€‚

## ç›¸å…³æ–‡ä»¶

- [`api_exception.dart`](api_exception.dart) - å¼‚å¸¸å®šä¹‰
- [`api_interceptor.dart`](api_interceptor.dart) - æ‹¦æˆªå™¨å®ç°
- [`api_client.dart`](api_client.dart) - API å®¢æˆ·ç«¯
- [`token_manager.dart`](token_manager.dart) - Token ç®¡ç†å™¨
- [`network.dart`](network.dart) - å¯¼å‡ºæ–‡ä»¶
- `package:bipupu/core/api/export.dart` - ç”Ÿæˆçš„ API å¯¼å‡º

## æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿã€‚
